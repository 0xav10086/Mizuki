<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Mizuki</title>
  <subtitle>One demo website</subtitle>
  <link href="https://0xav10086.space/" rel="alternate" type="text/html"/>
  <link href="https://0xav10086.space/atom.xml" rel="self" type="application/atom+xml"/>
  <id>https://0xav10086.space/</id>
  <updated>2026-01-29T10:28:15.244Z</updated>
  <language>zh_CN</language>
  <entry>
    <title>how-to-configuration-HTTPS</title>
    <link href="https://0xav10086.space/posts/how-to-configuration-https/" rel="alternate" type="text/html"/>
    <id>https://0xav10086.space/posts/how-to-configuration-https/</id>
    <published>2026-01-29T00:00:00.000Z</published>
    <updated>2026-01-29T00:00:00.000Z</updated>
    <summary>这个教程将会教你如何配置HTTPS。</summary>
    <content type="html"><![CDATA[<h2>第一步：获取 Cloudflare 名称服务器</h2>
<p>在操作阿里云之前，请确保你已经：</p>
<ol>
<li>
<p>在 <a href="https://dash.cloudflare.com/">Cloudflare 官网</a> 点击 <strong>Add a Site</strong> 并输入你的域名。</p>
</li>
<li>
<p>选择订阅计划（通常选 <strong>Free</strong> 即可）。</p>
</li>
<li>
<p>扫描完成后，Cloudflare 会提供两个类似 <code>lina.ns.cloudflare.com</code> 和 <code>theo.ns.cloudflare.com</code> 的地址。<strong>请复制并保存这两个地址。</strong></p>
</li>
</ol>
<hr />
<h2>第二步：在阿里云修改 DNS 设置</h2>
<p>由于阿里云控制台经常更新，这里是最新的导航路径：</p>
<ol>
<li>
<p><strong>登录控制台</strong>：进入 <a href="https://dc.console.aliyun.com/">阿里云域名控制台</a>。</p>
</li>
<li>
<p><strong>定位域名</strong>：在“域名列表”中找到你想要设置的域名。</p>
</li>
<li>
<p><strong>进入管理</strong>：点击该域名右侧操作列的 <strong>管理</strong> 按钮。</p>
</li>
<li>
<p><strong>左侧菜单</strong>：在左侧导航栏中，依次点击 <strong>DNS 管理</strong> &gt; <strong>DNS 修改</strong>。</p>
</li>
<li>
<p><strong>修改服务器</strong>：</p>
<ul>
<li>
<p>点击页面上方的 <strong>修改 DNS 服务器</strong>。</p>
</li>
<li>
<p>在弹出的输入框中，删除原有的阿里云 DNS 地址。</p>
</li>
<li>
<p>填入 Cloudflare 给你的那两个名称服务器地址（一次填一个，通常有两个框）。</p>
</li>
</ul>
</li>
<li>
<p><strong>保存验证</strong>：点击 <strong>确认</strong>。系统可能会要求你进行手机验证码或身份验证，完成后提交即可。</p>
</li>
</ol>
<p>修改后的DNS服务器如下图所示：
<img src=".%5CResource%5C20260129012443.png" alt="w-50%" /></p>
<hr />
<h2>第三步：等待生效</h2>
<ul>
<li>
<p><strong>生效时间</strong>：修改 DNS 服务器后，全球同步通常需要 <strong>几分钟到 48 小时</strong> 不等（大部分情况下 10 分钟内生效）。</p>
</li>
<li>
<p><strong>检查状态</strong>：回到 Cloudflare 控制台，点击 <strong>Check nameservers</strong>。当 Cloudflare 显示 "Great news! Cloudflare is now protecting your site" 时，说明设置成功。</p>
</li>
</ul>
<hr />
<h3>💡 核心注意事项</h3>
<ul>
<li>
<p><strong>原解析记录</strong>：在修改 DNS 之前，确保 Cloudflare 已经正确同步（扫描）了你之前的 A 记录、CNAME 记录等。如果没同步完整，手动在 Cloudflare 中添加，否则会导致网站暂时无法访问。</p>
</li>
<li>
<p><strong>DNSSEC</strong>：如果你在阿里云开启了 DNSSEC 保护，<strong>必须先在阿里云关闭它</strong>，否则修改 DNS 服务器会导致解析彻底中断。</p>
</li>
</ul>
<p>配置之后的Cloudflare的DNS记录如下图所示：</p>
<p><img src=".%5CResource%5C20260129012215.png" alt="w-50%" /></p>
<p>为了支持 HTTPS，最稳妥且主流的方法是先配置 HTTP，然后使用 <strong>Certbot (Let's Encrypt)</strong> 自动获取证书并升级到 HTTPS。</p>
<hr />
<h2>第四步：创建 Nginx 配置文件</h2>
<p>在 Ubuntu/Debian 系统上，建议为每个站点创建独立的配置文件。执行以下命令：</p>
<pre><code># 创建并编辑配置文件
nano /etc/nginx/sites-available/0xav10086.conf
</code></pre>
<p>将以下内容粘贴进去（注意替换 <code>dash</code> 的代理配置）：</p>
<pre><code># 1. 博客主站 (静态文件)
server {
    listen 80;
    server_name www.0xav10086.space 0xav10086.space;

    root /var/www/blog;
    index index.html;

    location / {
        # 针对 Astro 等前端框架，优先匹配文件，匹配不到则返回 404
        try_files $uri $uri/ =404;
    }
}

# 2. Dash 子域名 (反向代理)
server {
    listen 80;
    server_name dash.0xav10086.space;

    location / {
        proxy_pass http://127.0.0.1:8686;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
</code></pre>
<hr />
<h2>第五步：启用配置并测试</h2>
<ol>
<li>
<p><strong>建立软链接</strong>以启用配置：</p>
<pre><code>ln -s /etc/nginx/sites-available/0xav10086.conf /etc/nginx/sites-enabled/
</code></pre>
</li>
<li>
<p><strong>测试 Nginx 语法</strong>是否正确：</p>
<pre><code>nginx -t
</code></pre>
<p>如果显示 <code>syntax is ok</code> 和 <code>test is successful</code>，则重启 Nginx：</p>
<pre><code>systemctl restart nginx
</code></pre>
</li>
</ol>
<hr />
<h2>第六步： 配置 HTTPS (SSL 证书)</h2>
<p>我们使用 Certbot 来自动化这个过程，它会自动修改你的 Nginx 文件并添加重定向。</p>
<ol>
<li>
<p><strong>安装 Certbot</strong>：</p>
<pre><code>apt update
apt install certbot python3-certbot-nginx -y
</code></pre>
</li>
<li>
<p><strong>获取并配置证书</strong>：</p>
<p>执行以下命令，Certbot 会自动识别你配置文件里的域名：</p>
<pre><code>certbot --nginx -d 0xav10086.space -d www.0xav10086.space -d dash.0xav10086.space
</code></pre>
<ul>
<li>
<p><strong>提示 1</strong>: 会询问你的邮箱，用于接收证书过期提醒。</p>
</li>
<li>
<p><strong>提示 2</strong>: 会询问是否自动将 HTTP 重定向到 HTTPS，建议选择 <strong>2 (Redirect)</strong>。</p>
</li>
</ul>
</li>
</ol>
<hr />
<h2>验证结果</h2>
<p>现在你可以尝试在浏览器打开：</p>
<ul>
<li>
<p><code>https://www.0xav10086.space</code> —— 应该看到你的 Fuwari 博客。</p>
</li>
<li>
<p><code>https://dash.0xav10086.space</code> —— 应该看到你 8686 端口的服务。</p>
</li>
</ul>
<h3>💡 避坑小贴士</h3>
<ul>
<li>
<p><strong>防火墙</strong>：确保你的 VPS 开启了 <strong>80 (HTTP)</strong> 和 <strong>443 (HTTPS)</strong> 端口。如果是阿里云/腾讯云，记得在安全组里放行。</p>
</li>
<li>
<p><strong>域名解析</strong>：确保你的 DNS 服务商那里已经把 <code>www</code>, <code>@</code> (根域名) 和 <code>dash</code> 都指向了你的 VPS IP。</p>
</li>
<li>
<p><strong>权限</strong>：如果访问报 403 错误，执行 <code>chmod -R 755 /var/www/blog</code> 确保 Nginx 有权读取文件。</p>
</li>
</ul>
]]></content>
    <author>
      <name>0xav10086</name>
    </author>
    <category term="Server"></category>
  </entry>
  <entry>
    <title>how-to-use-github-actions</title>
    <link href="https://0xav10086.space/posts/how-to-use-github-actions/" rel="alternate" type="text/html"/>
    <id>https://0xav10086.space/posts/how-to-use-github-actions/</id>
    <published>2026-01-29T00:00:00.000Z</published>
    <updated>2026-01-29T00:00:00.000Z</updated>
    <summary>这个教程将会教你如何使用Github的actions来自动化部署。</summary>
    <content type="html"><![CDATA[<h2>1. GitHub 网页端设置：开启与保护</h2>
<p>由于我的仓库是 <strong>Fork</strong> 来的，GitHub 为了安全会默认锁定自动化脚本。</p>
<ul>
<li>
<p><strong>启用 Actions</strong>：必须手动进入仓库的 <strong>Actions</strong> 选项卡，点击 <strong>"I understand my workflows, go ahead and enable them"</strong> 才能激活工作流。</p>
</li>
<li>
<p><strong>配置加密保险箱 (Secrets)</strong>：</p>
<ul>
<li>
<p><strong>路径</strong>：<code>Settings -&gt; Secrets and variables -&gt; Actions -&gt; Repository secrets -&gt; New repository secrets</code>。</p>
</li>
<li>
<p><strong>原则</strong>：千万不要在代码中明文写入 IP、用户名或私钥。</p>
</li>
<li>
<p><strong>必填条目</strong>：<code>SSH_HOST</code> (IP)、<code>SSH_USER</code> (通常为 root)、<code>SSH_KEY</code> (完整的 <strong>私钥</strong> 内容)。</p>
</li>
</ul>
</li>
</ul>
<p><img src=".%5CResource%5C20260129010211.png" alt="w-50%" /></p>
<hr />
<h2>2. CI.yml 编写：自动化的指令集</h2>
<p>针对“本地构建 <code>dist</code>，GitHub 搬运”的需求，核心配置如下：</p>
<ul>
<li>
<p><strong>触发条件 (<code>on</code>)</strong>：设置为 <code>push: branches: [master]</code>，确保你每次 <code>git push</code> 都会触发部署。</p>
</li>
<li>
<p><strong>搬运工具 (<code>rsync</code>)</strong>：推荐使用 <code>Burnett01/rsync-deployments</code>，因为它比单纯的 SSH 命令更擅长处理文件夹同步。</p>
</li>
<li>
<p><strong>关键代码段</strong>：</p>
</li>
</ul>
<pre><code>    with:
      switches: -avzr --delete       # -a 同步属性, --delete 保持目标与源完全一致
      path: dist/                    # 仓库中的源目录
      remote_path: /var/www/blog      # VPS 上的目的地
      remote_host: ${{ secrets.SSH_HOST }}
      remote_user: ${{ secrets.SSH_USER }}
      remote_key: ${{ secrets.SSH_KEY }}
</code></pre>
<hr />
<h2>3. VPS 端设置：安全门禁与接收</h2>
<p>VPS 是部署的终点，必须配置好接收权限。</p>
<ul>
<li>
<p><strong>SSH 密钥对</strong>：</p>
<ul>
<li>
<p>使用 <code>ed25519</code> 算法生成，更安全高效。</p>
</li>
<li>
<p><strong>公钥</strong> (<code>.pub</code>) 必须存放在 VPS 的 <code>~/.ssh/authorized_keys</code> 中。</p>
</li>
<li>
<p><strong>私钥</strong> 交给 GitHub Secrets。</p>
</li>
</ul>
</li>
<li>
<p><strong>权限规范</strong>（SSH 极其挑剔）：</p>
<ul>
<li>
<p><code>~/.ssh</code> 目录：<code>700</code>。</p>
</li>
<li>
<p><code>authorized_keys</code> 文件：<code>600</code>。</p>
</li>
</ul>
</li>
<li>
<p><strong>环境准备</strong>：</p>
<ul>
<li>
<p>手动创建目标目录：<code>mkdir -p /var/www/blog</code>。</p>
</li>
<li>
<p>配置 Nginx：将 <code>root</code> 指向该目录，并使用 Certbot 开启 HTTPS。详细的配置过程可以参照[[配置HTTPS]]这篇教程。</p>
</li>
</ul>
</li>
</ul>
<h3>详细的配置流程</h3>
<p>以下是详细的配置流程。请按顺序在 VPS 上检查：</p>
<h4>1. 检查 VPS 上的权限</h4>
<p>SSH 对文件权限极其敏感。如果权限太高，SSH 会出于安全考虑拒绝连接。请在 VPS 终端执行：</p>
<pre><code># 生成密钥
ssh-keygen -t ed25519 -N "" -f ~/.ssh/id_ed25519 -C "github-actions-deploy"

# 信任该公钥
cat ~/.ssh/id_ed25519.pub &gt;&gt; ~/.ssh/authorized_keys

# 确保 .ssh 目录权限为 700
chmod 700 ~/.ssh

# 确保 authorized_keys 权限为 600
chmod 600 ~/.ssh/authorized_keys

# 确保 /root 或 /home/用户 目录没有赋予过高的组权限
chmod 755 /root
</code></pre>
<hr />
<h4>2. 核对公钥内容</h4>
<p>请确认公钥是否<strong>完整且正确</strong>地存放在了 <code>authorized_keys</code> 文件中：</p>
<ol>
<li>
<p>查看公钥内容：</p>
<pre><code>cat ~/.ssh/id_ed25519.pub
</code></pre>
</li>
<li>
<p>查看 <code>authorized_keys</code> 文件：</p>
<pre><code>cat ~/.ssh/authorized_keys
</code></pre>
<p><strong>检查点</strong>：<code>authorized_keys</code> 中必须包含一行以 <code>ssh-ed25519 ... github-actions-deploy</code> 结尾的内容。如果里面有换行错误或字符缺失，请清空它并重新写入：</p>
<pre><code>echo "这里粘贴你刚才查看到的 id_ed25519.pub 完整内容" &gt; ~/.ssh/authorized_keys
</code></pre>
</li>
</ol>
<hr />
<h4>3. 检查 root 用户登录限制</h4>
<p>如果在 <code>SSH_USER</code> 中填的是 <code>root</code>，很多 Linux 系统默认是禁止 root 通过密钥远程登录的。</p>
<ol>
<li>
<p>打开 SSH 配置文件：</p>
<pre><code>nano /etc/ssh/sshd_config
</code></pre>
</li>
<li>
<p>查找并确保以下两行没有被注释（前面没有 <code>#</code>）且设置正确：</p>
<pre><code>PubkeyAuthentication yes
PermitRootLogin yes
</code></pre>
</li>
<li>
<p>如果修改了文件，记得重启 SSH 服务：</p>
<pre><code>systemctl restart ssh
</code></pre>
</li>
</ol>
<hr />
<h4>4. 再次核对 GitHub 端的 SSH_KEY</h4>
<p>请再次确认你在 GitHub <strong>Secrets</strong> 中填入的是 <strong>私钥</strong>（即没有 <code>.pub</code> 后缀的那个文件）。</p>
<ul>
<li>
<p><strong>错误做法</strong>：把 <code>id_ed25519.pub</code>（公钥）填到了 GitHub。</p>
</li>
<li>
<p><strong>正确做法</strong>：把 <code>id_ed25519</code>（内容以 <code>-----BEGIN OPENSSH PRIVATE KEY-----</code> 开头）填到了 GitHub。</p>
</li>
</ul>
<hr />
<h2>4. 验证工作是否修复</h2>
<p>你可以点击 GitHub 上的 <strong>"Run workflow"</strong>。如果权限配置正确，你会看到日志显示：</p>
<ul>
<li>
<p><strong>绿色对勾 (✔️)</strong>：恭喜，部署成功。</p>
</li>
<li>
<p><strong>红色叉号 (❌)</strong>：出错了。点击进去看具体的错误日志（比如 <code>Permission denied</code> 或者 <code>No such file or directory</code>）。</p>
</li>
</ul>
<p><img src=".%5CResource%5C20260129010902.png" alt="w-50%" /></p>
<p>当在 Actions 页面看到 <strong>红叉 (❌)</strong> 时，可以根据日志快速定位：</p>
<table>
<thead>
<tr>
<th><strong>错误提示</strong></th>
<th><strong>原因</strong></th>
<th><strong>解决方法</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><code>Name does not resolve</code></strong></td>
<td><code>remote_host</code> 变量为空</td>
<td>检查 Secrets 里的变量名是否拼写正确。</td>
</tr>
<tr>
<td><strong><code>Permission denied (password)</code></strong></td>
<td>VPS 拒绝了密钥</td>
<td>1. 检查公钥是否在 <code>authorized_keys</code> 中；2. 检查 <code>.ssh</code> 目录权限。</td>
</tr>
<tr>
<td><strong><code>No such file or directory</code></strong></td>
<td>VPS 路径不存在</td>
<td>在 VPS 上手动执行 <code>mkdir -p</code> 创建目标文件夹。</td>
</tr>
<tr>
<td><strong><code>Certbot: DNS check failed</code></strong></td>
<td>域名未解析</td>
<td>在 Cloudflare 添加根域名（@）的 A 记录 。</td>
</tr>
</tbody>
</table>
<hr />
<h2>5. 终极工作流</h2>
<p>以后更新博客只需要：</p>
<ol>
<li>
<p><strong>本地</strong>：写文章。</p>
</li>
<li>
<p><strong>本地</strong>：<code>pnpm build</code>（生成最新的 <code>dist</code>）。</p>
</li>
<li>
<p><strong>本地</strong>：<code>git add .</code> -&gt; <code>git commit</code> -&gt; <code>git push</code>。</p>
</li>
<li>
<p><strong>云端</strong>：GitHub 自动把文件推送到 VPS。</p>
</li>
<li>
<p><strong>结果</strong>：刷新 <code>0xav10086.space</code> 即可看到更新。</p>
</li>
</ol>
]]></content>
    <author>
      <name>0xav10086</name>
    </author>
    <category term="Git"></category>
  </entry>
</feed>